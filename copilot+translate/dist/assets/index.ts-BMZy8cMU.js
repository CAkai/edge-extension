const s="http://192.168.1.165:3003/",n="icloud-side-panel";let c=!1;const t={id:"",name:"",email:"",access_token:"",role:"user",department:"",fab:""};chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:n,title:chrome.i18n.getMessage("extensionName"),contexts:["all"]})});chrome.tabs.onActivated.addListener(()=>{c||i()});async function i(){let a=await chrome.tabs.query({active:!0,currentWindow:!0});if(a=a.filter(o=>o.url&&!o.url.startsWith("chrome://")),a.length===0)return;const r=await chrome.scripting.executeScript({target:{tabId:a[0].id??0},func:()=>JSON.stringify(localStorage)});if(console.error("localstorage",r[0].result),r[0].result){const o=JSON.parse(r[0].result);t.access_token=o["umc-camera-access_token"],console.error("token",t.access_token),await fetch(s+"api/v1/auth",{method:"GET",headers:{Authorization:`Bearer ${t.access_token}`}}).then(e=>e.json()).then(e=>{t.id=e.id,t.name=e.name,t.email=e.email,t.role=e.role,t.department=e.department,t.fab=e.fab,console.error("2",t)}).catch(e=>{console.error("error",e)}),c=!0}}chrome.contextMenus.onClicked.addListener((a,r)=>{a.menuItemId===n&&chrome.tabs.sendMessage((r==null?void 0:r.windowId)??0,{type:"openSidePanel"})});
