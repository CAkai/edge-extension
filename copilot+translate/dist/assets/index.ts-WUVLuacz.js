import{u as s}from"./user.store-CxFpjZnn.js";const n="icloud-side-panel";let a=!1;chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:n,title:chrome.i18n.getMessage("extensionName"),contexts:["all"]})});chrome.tabs.onActivated.addListener(()=>{a||i()});async function i(){let t=await chrome.tabs.query({active:!0,currentWindow:!0});if(t=t.filter(o=>o.url&&!o.url.startsWith("chrome://")),t.length===0)return;const r=await chrome.scripting.executeScript({target:{tabId:t[0].id??0},func:()=>JSON.stringify(localStorage)});if(r[0].result){const o=JSON.parse(r[0].result);await fetch("http://192.168.1.165:3003/api/v1/auth",{method:"GET",headers:{Authorization:`Bearer ${o.access_token}`}}).then(e=>e.json()).then(e=>{if(e.error){console.error(`連線到 iCloud 時，發生了錯誤：${e.error}`);return}e.access_token!==""&&(s.dispatch({type:"user/save",payload:e}),console.log("搜尋到 iCloud Token，正在自動登入..."))}).catch(e=>{console.error("error",e)}),a=!0}}chrome.contextMenus.onClicked.addListener((t,r)=>{t.menuItemId===n&&chrome.tabs.sendMessage((r==null?void 0:r.windowId)??0,{type:"openSidePanel"})});
